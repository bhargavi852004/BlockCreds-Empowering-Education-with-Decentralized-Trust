{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}
{% block header %}Dashboard{% endblock %}

{% block content %}

<!-- Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transform transition hover:-translate-y-1 hover:shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary to-secondary"></div>
        <h2 class="text-gray-600 dark:text-gray-400 text-sm font-semibold mb-2">Total Certificates</h2>
        <p class="text-3xl font-bold text-primary">{{ total_certificates }}</p>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transform transition hover:-translate-y-1 hover:shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-400 to-green-600"></div>
        <h2 class="text-gray-600 dark:text-gray-400 text-sm font-semibold mb-2">Active Certificates</h2>
        <p class="text-3xl font-bold text-green-500">{{ active_certificates }}</p>
    </div>
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 transform transition hover:-translate-y-1 hover:shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-400 to-red-600"></div>
        <h2 class="text-gray-600 dark:text-gray-400 text-sm font-semibold mb-2">Revoked Certificates</h2>
        <p class="text-3xl font-bold text-red-500">{{ revoked_certificates }}</p>
    </div>
</div>

<!-- Charts -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
        <h3 class="text-lg font-semibold mb-4">Certificates Issued (Last 7 Days)</h3>
        <canvas id="issuedChart" class="w-full" style="max-height: 300px;"></canvas>
    </div>
    <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
        <h3 class="text-lg font-semibold mb-4">Active vs Revoked</h3>
        <canvas id="revokedChart" class="w-full" style="max-height: 300px;"></canvas>
    </div>
</div>

<!-- Floating Logout Button with Tooltip -->
<!-- Floating Logout Button -->
<div class="fixed bottom-6 right-6 z-50">
    <a href="{% url 'index' %}"
       class="flex items-center gap-2 bg-gradient-to-r from-primary to-secondary text-white font-semibold py-3 px-5 rounded-full shadow-lg transform transition hover:-translate-y-1 hover:scale-105 hover:shadow-2xl">
        <i class="fas fa-sign-out-alt"></i>
        Sign Out
    </a>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctxIssued = document.getElementById('issuedChart').getContext('2d');
    const ctxRevoked = document.getElementById('revokedChart').getContext('2d');

    const issuedChart = new Chart(ctxIssued, {
        type: 'line',
        data: {
            labels: {{ issued_labels|safe }},
            datasets: [{
                label: 'Certificates Issued',
                data: {{ issued_data|safe }},
                backgroundColor: 'rgba(79, 70, 229, 0.2)',
                borderColor: 'rgba(79, 70, 229, 1)',
                borderWidth: 2,
                fill: true,
                tension: 0.3,
                pointBackgroundColor: 'rgba(79, 70, 229, 1)',
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, precision: 0 } }
        }
    });

    const revokedChart = new Chart(ctxRevoked, {
        type: 'bar',
        data: {
            labels: ['Active', 'Revoked'],
            datasets: [{
                label: 'Certificates',
                data: [{{ active_certificates }}, {{ revoked_certificates }}],
                backgroundColor: ['rgba(34,197,94,0.8)','rgba(239,68,68,0.8)'],
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>

{% endblock %}
